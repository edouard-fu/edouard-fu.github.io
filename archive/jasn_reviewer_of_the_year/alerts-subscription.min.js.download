"use strict";var ejpAlerts=ejpAlerts||{};ejpAlerts.errors=ejpAlerts.errors||{},ejpAlerts.alertType={etoc:"etoc",pap:"pap"},ejpAlerts.errors.email={invalid:"This is not a valid email address, please try again."},Object.freeze(ejpAlerts.alertType),Object.freeze(ejpAlerts.errors.email),ejpAlerts.isEmailValid=function(e){return/^(([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5}){1,25})$/.test(e)},ejpAlerts.isValidAlertType=function(e){return e&&ejpAlerts.alertType.hasOwnProperty(e.toLowerCase())},ejpAlerts.subscribeToAlert=function(e,t,r,s,l){if(e&&!ejpAlerts.isEmailValid(e))s(ejpAlerts.errors.email.invalid);else if(ejpAlerts.isValidAlertType(t)){const i=`${window._spPageContextInfo&&window._spPageContextInfo.siteAbsoluteUrl||""}/_layouts/OAKS.Journals/AlertsSubscribionService.svc/SubscribeToAlert`,a="An error occured while subscribing to the alert.";let o={data:{}};e&&(o.data.email=e),l&&(o.data.setContextUrlAsDefaultPage=l),o.data.alertType=t,$.ajax({type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(o),url:i,success:function(e){if(2===e.status)return console.error(`An error occured while subscribing to ${t}.`),void s(e.message);r()},error:function(e,t,r){console.error(a),s(a)}})}else s("Alert Type is invalid.")},window.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".js-section-alert");if(e)for(let t=0;t<e.length;t++){const r=e[t],s=r.querySelector(".js-section-alert__content"),l=r.querySelector(".js-section-alert__subscribe-button"),i=r.querySelector(".js-section-alert--error"),a=l.getAttribute("data-alert-type"),o=l.getAttribute("data-subscribed-msg"),n=()=>{s.textContent=o,i.classList.contains("dn")||i.classList.add("dn")},c=e=>{i.textContent=e,i.classList.contains("dn")&&i.classList.remove("dn")};l.addEventListener("click",(e=>{let t=r.querySelector(".js-section-alert__email"),s=!0,l=null;if(t&&(l=t.value,ejpAlerts.isEmailValid(l)||(s=!1,c(ejpAlerts.errors.email.invalid))),s){let e=!!l;ejpAlerts.subscribeToAlert(l,a,n,c,e)}e.stopPropagation(),e.preventDefault()}))}})),(e=>{e((()=>{e(".js-subscribe-to-alerts-container").each(((t,r)=>{const s=e(r);s.find(".js-subscribe-to-alerts-btn").on("click",(t=>{const r=e(t.target),l=r.data("alert-type"),i=r.data("subscribed-msg");ejpAlerts.subscribeToAlert(null,l,(function(){r.hide(),s.find(".js-subscribe-to-alerts-body-text").text(i)}),(function(e){console.error(`Exception occurs during subscribing to ${l}.`)})),t.preventDefault(),t.stopPropagation()}))}))}))})(jQuery);